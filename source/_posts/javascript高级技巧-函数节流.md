---
title: JavaScript高级技巧-函数节流
date: 2018-01-18 20:35:13
tags: 高级技巧
---

## 问题
最近在开发拼购活动时，在支付流程发现这样一个问题： 连续快速的点击支付按钮，在安卓机上会弹出好几次支付密码框。 不停地点不停地点，在有些安卓机上，页面直接卡住了。iOS手机很稳，什么问题都木有。

这里就想到，需要在一段时间内，点击事件不停的被触发时，接下来的代码需要控制住不要执行。这里就用到了函数节流。

## 函数节流
### 基本思想
控制需要执行的代码，不让它在没有间断的情况下连续触发重复执行。所以，需要创建一个定时器，给一个间隔时间，在这段时间内不能运行代码。然后，点击事件重复触发时，给一个clearTimeout，清除之前设置的定时器，然后重新设置一个。
这里的意思是，如果前一个定时器还没有被触发，那直接被清除设置成新的，第一次定时的代码也不会执行。 假设被触发了，已经是过了一段时间了。这样就在一定时间内，控制了用户不停操作带来的代码段重复执行的问题。
### 初步方案
《JavaScript高级程序设计》中给出了解决方案，代码如下：

```
function throttle(method, context) {
	clearTimeout(method.tId);
	method.tId = setTimeout(function(){
		method.call(context)
	}, 100)
}
```
这里，第一个函数是要执行的函数，第二个是执行的作用域。
### 升级方案
以上是初步的函数节流的方法，但是还有些地方需要改进。
